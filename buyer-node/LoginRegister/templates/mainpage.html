<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"
        integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn"
        crossorigin="anonymous"></script>

    <script>
        // wait for the DOM to be loaded
        $(function () {
            function initRecommendation() {
                // TODO: change to login user id
                var userId = 'yz6238'
                var ajax = $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/init-recommendation",
                    headers: {
                        "Access-Control-Allow-Origin": "*"
                    },
                    data: {
                        "userId": userId
                    }
                });
            }

            initRecommendation()

            $("#update-geo-btn").click(function () {
                var longitude = $("#longitude").val();
                var latitude = $("#latitude").val();

                var ajax = $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/geolocation",
                    headers: {
                        "Access-Control-Allow-Origin": "*"
                    },
                    data: {
                        "longitude": longitude,
                        "latitude": latitude
                    }
                });
                return false;
            })

            $("#update-recommendation-btn").click(function () {
                var ajax = $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/recommendation",
                    headers: {
                        "Access-Control-Allow-Origin": "*"
                    },
                    success: function (res) {
                        updateRecommendationList(res);
                    }
                });
                return false;
            })

            $("#search-btn").click(function () {
                var category = $("#category").val();

                var ajax = $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/search",
                    headers: {
                        "Access-Control-Allow-Origin": "*"
                    },
                    data: {
                        "category": category
                    },
                    success: function (res) {
                        updateSearchResult(res);
                    }
                });
                return false;
            })

            function updateSearchResult(res) {
                const data = res['data'];
                var items = [];
                for (var i in data) {
                    var item = data[i];
                    items.push('<pre id="' + item._id + '">' + JSON.stringify(item) + '</pre>');
                }
                $('#searchResult').html(items.join(''));
            }

            function updateRecommendationList(res) {
                const data = res['data'];
                var items = [];
                for (var i in data) {
                    var item = data[i];
                    items.push('<pre id="' + item._id + '">' + JSON.stringify(item) + '</pre>');
                }
                $('#recommendationResult').html(items.join(''));
            }
        })
    </script>
</head>

<body>
    <div>
        <p>Welcome to my empty home page</p>
    </div>

    <div>
        <form action="/">
            <input value="logout" type="submit">
        </form>
    </div>

    <h1>Search Item</h1>

    <form id="searchForm">
        <label>category </label>
        <input type="text" id="category" name="category"><br><br>
        <button type="submit" id="search-btn">Search</button>
    </form>

    <div id="searchResult">
    </div>

    <div>
        <label>longitude </label>
        <input type="text" id="longitude" name="longitude"><br><br>
        <label>latitude </label>
        <input type="text" id="latitude" name="latitude"><br><br>
        <button type="submit" id="update-geo-btn">Update Geolocation</button>
        <button type="submit" id="update-recommendation-btn">Update recommendation</button>
    </div>

    <div id="recommendationResult">
    </div>
</body>

</html>